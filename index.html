<!DOCTYPE html>
<head>
<meta charset="UTF-8">
<style>
	img{
		max-width:80%;
		display:block;
	}
</style>
</head>
<body>
	<input type="file" multiple="true" id="uploads">
	<div id="pictures"></div>
	<img id="pics">
	<p id="info"></p>
	<p id="progress"></p>
</body>

<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="jquery.lazyload.min.js"></script>
<script src="up.itorr.js"></script>

<script>
$('img').lazyload();
$('#uploads').change(function(){
	if(!this.files||!this.files[0]) {
		return alert('选取文件出错！');
	}

	for (var i = 0, len = this.files.length; i < len; i ++) {
		console.log(len);
		var picfile=this.files[i];

		if (picfile.type.indexOf('image')!=0) {
			return alert('这不是一个图像呀！');
		}
		
		UP(picfile,function(pid){
			$('#pictures')[0].innerHTML += '<img src="' + 'http://ww2.sinaimg.cn/large/' + pid +'">';
			$('#info')[0].innerHTML += 'http://ww2.sinaimg.cn/large/' + pid + '<br />';
			// $('#info')[0].innerHTML=$('#pics')[0].src='http://ww2.sinaimg.cn/large/'+pid;
			var postData = JSON.stringify({'url': 'http://ww2.sinaimg.cn/large/' + pid});
			console.log(postData);
			$.ajax({
				type: 'POST',
				url: 'save.php',
				data: postData,
				dataType: 'json',
				success: function (json) {
					alert(json.msg);
				}
			});
		},function(){
			alert('上传文件出错了！');
		},function(progress){
			$('#progress')[0].innerHTML=progress*100+'%';
		})
	}
});
</script>